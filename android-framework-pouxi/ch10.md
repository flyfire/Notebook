### 10.AMS内部原理

AMS所提供的主要功能包括以下几项:

+ 统一调度各应用程序的Activity.应用程序要运行Activity,会首先报告给AMS,然后由AMS决定该Activity是否可以启动,如果可以,AMS再通知应用程序运行指定的Activity.换句话说,运行Activity时各应用程序的内政,AMS并不干预,但是AMS必须知道各应用程序都运行了哪些Activity.
+ 内存管理,Activity退出后,其所在的进程并不会被立即杀死,从而下次在启动该Activity时能够提高启动速度.这些Activity只有当系统内存紧张时,才会被自动杀死,应用程序不用关心这个问题,这些正是AMS中完成的.
+ 进程管理,AMS向外提供了查询系统正在运行的进程信息的API

AMS中定义了几个重要的数据类,分别用来保存进程(Process),活动(Activity)和任务(Task).

进程数据类ProcessRecord.

| 变量作用                                | 主要包含                                                     |
| --------------------------------------- | ------------------------------------------------------------ |
| 进程文件信息                            | 与进程对应的APK文件的内部信息,比如 String processNme,ArrayMap<String, ProcessStats.ProcessStateHolder> pkgList;// 运行在当前进程的所有packages |
| 进程的内存状态信息                      | 这些信息将用于Linux系统的OOM情况的处理,当发生系统内存不够用时,Linux会根据进程的内存状态信息,杀掉优先级比较低的进程; int maxAdj; int curAdj; |
| 进程中包含的Activity,Provider,Service等 | ArrayList<ActivityRecord> activities;ArrayList<TaskRecord> recentTasks;ArraySet<ServiceRecord> services;ArraySet<ServiceRecord> executingServices;ArraySet<ConnectionRecord> connections;ArraySet<ReceiverList> receivers |

ActivityRecord数据类

| 变量作用     | 主要包含                                                     |
| ------------ | ------------------------------------------------------------ |
| 环境信息     | Activity的工作环境,比如,隶属于哪个package,所在的进程名称,文件路径,数据路径,图标,主题等 String packageName;String processName;String taskAffinity;int labelRes;int theme;int windowFlags; |
| 运行状态信息 | 比如idle,stop,finishing等boolean sleeping;boolean nowVisible;boolean idle;boolean hasBeenLaunched;boolean immersive; |

