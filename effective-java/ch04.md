# 第4章 类和接口

### 13.使类和成员的可访问性最小化

信息隐藏information hiding 或 封装 encapsulation

尽可能地使每个类或者成员不被外界访问。

对于顶层的（非嵌套的）类和接口，只有两种可能的访问级别：包级私有的package-private和公有的public。

对于成员（域、方法、嵌套类和嵌套接口）有四种可能的访问级别，下面按照可访问性的递增顺序罗列出来：

+ 私有的private，只有在声明该成员的顶层类内部才可以访问这个成员
+ 包级私有的package-private，声明该成员的包内部的任何类都可以访问这个成员。从技术上讲，它被称为缺省default访问级别，如果没有为成员指定访问修饰符，就采用这个访问级别。
+ 受保护的protected，声明该成员的类的子类可以访问这个成员，[但有一些限制](https://docs.oracle.com/javase/specs/jls/se7/html/jls-6.html)，并且，声明该成员的包内部的任何类也可以访问该成员。[不同package的子类继承也不能访问父类的protected成员](https://github.com/flyfire/YouDontKnowJava/tree/master/src/com/solarexsoft/test/testprotected)
+ 公有的public，在任何地方都可以访问该成员。

如果方法覆盖了超类中的一个方法，子类中的访问级别就不允许低于超类中的访问类别。这样可以确保任何可使用超类的实例的地方也都可以使用子类的实例。这条规则有种特殊的情形：如果一个类实现了一个接口，那么接口中的所有的类方法在这个类中也都必须被声明为公有的。之所以如此，是因为接口中的所有方法都隐含着公有访问级别。

实例域决不能是公有的。包含公有可变域的类并不是线程安全的。同样的建议也适用于静态域。

长度非零的数组总是可变的，所以，类具有公有的静态final数组域，或者返回这种域的访问方法，这几乎总是错误的。可以使公有数组变成私有的，并增加一个公有的不可变列表：

```java
private static final Thing[] PRIVATE_VALUES = { ... };
public static final List<Thing> VALUES = Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));
```

另一种方法是，可以使数组变成私有的，并添加一个公有方法，它返回私有数组的一个备份：

```java
private static final Thing[] PRIVATE_VALUES = { ... };
public static final Thing[] values() {
    return PRIVATE_VALUES.clone();
}
```

### 14.在公有类中使用访问方法而非公有域

如果类可以在它所在的包的外部进行访问，就提供访问方法，以保留将来改变该类的内部表示法的灵活性。

### 15.使可变性最小化

为了使类称为不可变，要遵循下面五条规则：

- 不要提供任何会修改对象状态的方法
- 保证类不会被扩展
- 使所有的域都是final的
- 使所有的域都成为私有的
- 确保对于任何可变组件的互斥访问。如果类具有指向可变对象的域，则必须确保该类的客户端无法获得指向这些对象的引用。并且，永远不要用客户端提供的对象引用来初始化这样的域，也不要从任何访问方法中返回该对象引用。在构造器、访问方法和readObject方法中请使用保护性拷贝技术。

