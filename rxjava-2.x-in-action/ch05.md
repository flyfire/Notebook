## 5.变换操作符和过滤操作符

RxJava的变换操作符主要包括以下几种：

+ map()：对序列的每一项都用一个函数来变换Observable发射的数据序列。
+ flatMap()，concatMap()，flatMapIterable()：将Observable发射的数据集合变换为Observables集合，然后将这些Observable发射的数据平坦化地放进一个单独的Observable中
+ switchMap()：将Observable发射的数据集合变换为Observables集合，然后只发射这些Observables最近发射过的数据
+ scan()：对Observable发射的每一项数据应用一个函数，然后按顺序依次发射每一个值
+ groupBy()：将Observable拆分为Observable集合，将原始Observable发射的数据按key分组，每一个Observable发射过一组不同的数据
+ buffer()：定期从Observable收集数据到一个集合，然后把这些数据集合打包发射，而不是一次发射一个
+ window()：定期将来自Observable的数据拆分成一些Observable窗口，然后发射这些窗口，而不是每次发射一项
+ cast()：在发射之前强制将Observable发射的所有数据转换为指定类型

RxJava的过滤操作符主要包括以下几种：

+ filter()：过滤数据
+ takeLast()：只发射最后的N项数据
+ last()：只发射最后一项数据
+ lastOrDefault()：只发射最后一项数据，如果Observable为空，就发射默认值
+ takeLastBuffer()：将最后的N项数据当做单个数据发射
+ skip()：跳过开始的N项数据
+ skipLast()：跳过最后的N项数据
+ take()：只发射开始的N项数据
+ first()/takeFirst()：只发射第一项数据，或者满足某种条件的第一项数据
+ firstOrDefault()：只发射第一项数据，如果Observable为空，就发射默认值
+ elementAt()：发射第N项数据
+ elementAtOrDefault()：发射第N项数据，如果Observable数据少于N项，就发射默认值
+ sample()/throttleLast()：定期发射Observable最近的数据
+ throttleFirst()：定期发射Observable发射的第一项数据
+ throttleWithTimeout()/debounce()：只有当Observable在指定的时间段后还没有发射数据时，才发射一个数据
+ timeout()：如果在一个指定的时间段后还没发射数据，就发射一个异常
+ distinct()：过滤掉重复的数据
+ distinctUntilChanged()：过滤掉连续重复的数据
+ ofType()：只发射指定类型的数据
+ ignoreElements()：丢弃所有的正常数据，只发射错误或完成通知

flatMap操作符使用一个指定的函数对原始Observable发射的每一项数据执行变换操作，这个函数返回一个本身也发射数据的Observable，然后flatMap合并这些Observable发射的数据，然后将合并后的结果当做它自己的数据序列发射。
flatMap对这些Observables发射的数据做的是合并操作，因此它们可能是交错的。还有一个操作符不会让变换后的Observables发射的数据交错，它严格按照顺序发射这些数据，这个操作符就是concatMap。

groupBy操作符将一个Observable拆分为一些Observables集合，它们中的每一个都发射原始Observable的一个子序列。
buffer会定期收集Observable数据并放进一个数据包裹，然后发射这些数据包裹，而不是一次发射一个值。buffer操作符将一个Observable变换为另一个，原来的Observable正常发射数据，由变换产生的Observable发射这些数据的缓存集合。

window操作符定期将来自原始Observable的数据分解为Observable窗口，发射这些窗口，而不是每次发射一项数据。window发射的不是原始Observable的数据包，而是Observables，这些Observables中的每一个都发射原始Observable数据的一个子集，最后发射一个onComplete通知。

RxJava2.x中，使用first()需要一个默认的Item，对于Observable而言，使用了first()会返回Single类型。在RxJava2.x中，还有firstElement操作符表示只取第一个数据，没有默认值。firstOrError操作符表示要么能取到第一个数据，要么执行onError方法，它们分别返回Maybe类型和Single类型。

last操作符跟first操作符类型，需要一个默认的Item，也是返回Single类型。lastElement操作符表示取最后一个数据，没有默认值。lastOrError操作符表示要么取到最后一个数据，要么执行onError方法，它们分别返回Maybe类型和Single类型。

使用take操作符可以修改Observable的行为，返回前面的n项数据，发射完成通知，忽略剩余的数据。如果对一个Observable使用take(n)操作符，而那个Observable发射的数据少于n项，那么take操作符生成的Observable就不会抛出异常或者发射onError通知，而是仍然会发射那些数据。take有一个重载方法能够接受一个时长而不是数量参数。它会发射Observable开始的那段时间发射的数据，时长和时间单位通过参数指定。take的这个重载方法默认在computation调度器上执行，也可以使用参数来指定其他调度器。

使用takeLast操作符修改原始Observable，可以只发射Observable发射的最后n项数据，忽略前面的数据，同样，如果对一个Observable使用takeLast(n)操作符，而那个Observable发射的数据少于n项，那么takeLast操作符生成的Observable不会抛出异常或者发射onError通知，而是仍然发射那些数据。takeLast也有一个重载方法能够接受一个时长而不是数量参数。它会发射在原始Observable生命周期内最后一段时间发射的数据，时长和时间单位通过参数指定。

使用skip操作符，可以忽略Observable发射的前n项数据，只保留之后的数据。skip有一个重载方法能够接受一个时长而不是数量参数，它会丢弃原始Observable开始那段时间发射的数据，时长和时间单位通过参数指定。这个重载方法默认在computation调度器上执行，也可以使用参数来指定其他的调度器。

使用skipLast操作符修改原始Observable，可以忽略Observable发射的后n项数据，只保留前面的数据。同样，skipLast也有一个重载方法接受一个时长而不是数量参数。它会丢弃在原始Observable生命周期最后一段时间内发射的数据，时长和时间单位通过参数指定。这个重载方法默认在computation调度器上执行，也可以使用参数来指定其他的调度器。

elementAt操作符获取原始Observable发射的数据序列指定索引位置的数据项，然后当做自己的唯一数据发射。它传递一个基于0的索引值，发射原始Observable数据序列对应索引位置的值，如果传递给elementAt的值为5，那么它会发射第6想数据。如果传递的是一个负数，则将会抛出一个IndexOutOfBoundsException异常。如果原始Observable的数据项数小于index+1，那么会调用onComplete方法。elementAt还提供了一个带默认值的方法，它返回一个Single类型。

ignoreElements操作符抑制原始Observable发射的所有数据，只允许它的终止通知(onError/onComplete)通过。它返回一个Completable类型。

distinct操作符，distinct的过滤规则是：只允许还没有发射过的数据项通过。distinct还能接受一个Function作为参数，这个函数根据原始Observable发射的数据项产生一个Key，然后，比较这些Key而不是数据本身，来判定两个数据是否不同。

与distinct类似的是distinctUntilChanged操作符，该操作符与distinct的区别是，它只判定一个数据和它的直接前驱是否不同。

只发射通过谓词测试的数据项，filter操作符使用指定的一个谓词函数测试数据项，只有通过测试的数据才会被发射。