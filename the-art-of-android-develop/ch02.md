### 2.IPC机制

线程是CPU调度的最小单元，同时线程是一种有限的系统资源。而进程一般指一个执行单元，在PC和移动设备上指一个程序或一个应用。一个进程可以包含多个线程。

任何一个操作系统都需要有相应的IPC机制，比如Windows上可以通过剪贴板、管道和邮槽等来进行进程间通信；Linux上可以通过命名管道、共享内容、信号量等来进行进程间通信。

除了Binder，Android还支持Socket，通过Socket也可以实现任意两个终端之间的通信。

在Android中一个应用中存在多个进程，首先，在Android中使用多进程只有一种方法，那就是给四大组件（Activity,Service,BroadcastReceiver,ContentProvider）在AndroidManifest中指定android:process属性，除此之外没有其他方法，也就是说我们无法给一个线程火灾一个实体类指定其运行时所在的进程。其实还有另一种非常规的多进程方法，那就是通过JNI在native层去fork一个新的进程。

进程名以":"开头的含义是指要在当前的进程名前面附加上当前的包名，这是一种简写的方法，属于当前应用的私有进程，其他应用的组件不可以和它跑在同一个进程中，而进程名不以":"开头的进程属于全局进程，其他应用通过share UID方式可以和它跑在同一个进程中。

另个应用通过share UID跑在同一个进程中是有要求的，需要这两个应用有相同的Share UID并且签名相同才可以。在这种情况下，它们可以互相访问对方的私有数据，比如data目录、组件信息等，不管它们是否跑在同一个进程中。当然如果它们跑在同一个进程中，那么除了能共享data目录、组件信息，还可以共享内存数据，或者说它们看起来就像是一个应用的两个部分。

Android为每一个应用分配了一个独立的虚拟机，或者说为每个进程都分配一个独立的虚拟机，不同的虚拟机在内存分配上有不同的地址空间，这就导致在不同的虚拟机中访问同一个类对象会产生多份副本。所有运行在不同进程中的四大组件，只要它们之间需要通过内存来共享数据，都会共享失败，这也是多进程所带来的主要影响。

一般来说，使用多进程会造成如下几方面的问题：

+ 静态成员和单例模式完全失效
+ 线程同步机制完全失效
+ SharedPreferences的可靠性下降
+ Application会多次创建

当一个组件跑在一个新的进程中的时候，由于系统要在创建新的进程同时分配独立的虚拟机，所以这个过程其实就是启动一个应用的过程。因此，相当于系统又把这个应用重新启动了一遍，既然重新启动了，那么自然会创建新的Application。这个问题其实可以这么理解，运行在同一个进程中的组件是属于同一个虚拟机和同一个Application的，同理，运行在不同进程中的组件是属于两个不同的虚拟机和Application的。

实现跨进程通信的方式很多，比如通过Intent来传递数据，共享文件和SharedPreferences，基于Binder的Messenger和AIDL以及Socket等。

静态成员变量属于类不属于对象，所以不会参与序列化过程；使用transient关键字标记的成员变量不参与序列化过程。

Parcelable也是一个接口，只要实现这个接口，一个类的对象就可以实现序列化并可以通过Intent和Binder传递。

Intent,Bundle,Bitmap等实现了Parcelable接口。

Serializable是Java中的序列化接口，其使用起来简单但是开销大，序列化和反序列化过程需要大量的I/O操作，而Parcelable是Android中的序列化方式，因此更适合用在Android平台上，它的缺点是使用其阿里稍微麻烦些，但是它的效率很高，这是Android推荐的序列化方式，因此要首选Parcelable。Parcelable主要用在内存序列化上，通过Parcelable将对象序列化到存储设备中或者将对象序列化后通过网络传输也都是可以的，但是这个过程会稍显复杂，因此在这两种情况下建议使用Serializable。

直观来说，Binder是Android中的一个类，它继承了IBinder接口。从IPC角度来说，Binder是Android中的一种跨进程通信方式，Binder还可以理解为一种虚拟的物理设备，它的设备驱动是/dev/binder，该通信方式在Linux中没有；从Android Framework角度来说，Binder是ServiceManager连接各种Manager(ActivityManager，WindowManager等等)和相应ManagerService的桥梁；从Android应用层来说，Binder是客户端和服务端进行通信的媒介，当bindService的时候，服务端会返回一个包含了服务端业务调用的Binder对象，通过这个Binder对象，客户端就可以获取服务端提供的服务或者数据，这里的服务包括普通服务和基于AIDL的服务。