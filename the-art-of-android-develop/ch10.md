### 10.Android的消息机制

Android的消息机制主要是指Handler的运行机制，Handler的运行需要底层的MessageQueue和Looper的支撑。MessageQueue的中文翻译是消息队列，它的内部存储了一组消息，一队列的形式对外提供插入和删除的工作。虽然叫消息队列，但是它的内部存储结构并不是真正的队列，而是采用单链表的数据结构来存储消息列表。Looper的中文翻译为循环，在这里可以理解为消息循环。由于MessageQueue只是一个消息的存储单元，它不能去处理消息，而Looper就填补了这个功能，Looper会以无限循环的方式去查找是否有新消息，如果有的话就处理消息，否则就一直等待。Looper中海油一个特殊的概念，那就是ThreadLocal，它的作用是可以在每个线程中存储数据。Handler创建的时候会采用当前线程的Looper来构造消息循环系统，那么Handler内部如何获取到当前线程的Looper呢？就要使用ThreadLocal了，ThreadLocal可以在不同的线程中互不干扰地存储数据，通过ThreadLocal可以轻松获取每个线程的Looper。