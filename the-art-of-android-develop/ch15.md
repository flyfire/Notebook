### 15.Android性能优化

+ 布局优化，布局优化的思想很简单，就是尽量减少布局文件的层级。布局优化的另外一种手段是采用``<include>``标签，``<merge>``标签和ViewStub。``<include>``标签主要用于布局重用，``<merge>``标签一般和``<include>``配合使用，它可以降低减少布局的层级，而ViewStub则提供了按需加载的功能，当需要时才会将ViewStub中的布局加载到内存，这提高了程序的初始化效率。ViewStub继承了View，它非常轻量级且宽/高都是0，因此它本身不参与任何的布局和绘制过程。ViewStub的意义在于按需加载所需的布局文件。
+ 绘制优化是指View的onDraw方法要避免执行大量的操作，这主要体现在两个方面，首先，onDraw中不要创建新的局部对象，这是因为onDraw方法可能会被频繁调用，这样就会在一瞬间产生大量的临时对象，这不仅占用了过多的内存而且还会导致系统更加频繁gc，降低了程序的执行效率。另外一方面，onDraw方法中不要做耗时的任务，也不能执行成千上万次的循环操作，尽管每次循环都很轻量级，但是大量的循环仍然十分抢占CPU时间片，这会造成View的绘制过程不流畅。
+ 内存泄漏优化，内存泄漏的优化分为两个方面，一方面是在开发过程中避免写出有内存泄漏的代码，另一方面是通过一些分析工具比如MAT来找出潜在的内存泄漏继而解决。
+ 响应速度优化和ANR日志分析，响应速度优化的核心思想是避免在主线程中做耗时操作。Android规定，Activity如果5秒钟之内无法响应屏幕触摸时间或者键盘输入事件就会出现ANR，而BroadcastReceiver如果10秒钟之内还未执行完操作也会出现ANR。
+ ListView的优化主要分为三个方面：首先要采用ViewHolder并避免在getView中执行耗时操作；其次要根据列表的滑动状态来控制任务的执行频率，比如当列表快速滑动时显然是不太适合开启大量的异步任务的；最后可以尝试开启硬件加速来使ListView的滑动更加流畅。
+ 线程优化的思想是采用线程池，避免程序中存在大量的Thread。线程池可以重用内部的线程，从而避免了线程的创建和销毁所带来的性能开销，同时线程池还能有效地控制线程池的最大并发数，避免大量的线程因互相抢占系统资源从而导致阻塞现象的发生。
+ 一些性能优化建议：避免创建过多的对象；不要过多使用枚举，枚举占用的内存空间要比整型大；常量使用static final来修饰；使用一些Android特有的数据结构，比如SparseArray和Pair等，它们都具有更好的性能；适当使用软引用和弱引用；采用内存缓存和磁盘缓存；尽量采用静态内部类，这样可以避免潜在的由于内部类而导致的内存泄漏。